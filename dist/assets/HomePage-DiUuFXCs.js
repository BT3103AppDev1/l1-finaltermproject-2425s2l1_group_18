import{_ as L,m as J,g as K,r as o,n as Q,p as W,c as u,x as w,a as e,t as r,F as N,y as P,b as X,d as Z,z as g,A as _,w as tt,B as et,j as m,l as D,q as nt,k as lt,C as st,f as $,D as U,o as i}from"./index-DXTcdSJ3.js";import{N as at}from"./TheNavbar-CtdwB5Id.js";const ot={class:"container"},rt={key:0},ut={key:1},it={key:2},dt=["onClick"],ct={class:"find-client-container"},gt={class:"modal"},vt={class:"charts-container"},ft={class:"chart"},pt={key:3},yt=["value"],mt={class:"charts-container"},Dt={class:"chart"},ht={class:"chart"},Ct={__name:"HomePage",setup(wt){const c=J(),M=K(),b=o([]),v=o(""),h=o([]),T=o([]),x=o([]),I=o([]),k=o([]),B=o({}),y=o({}),E=o(0),A=async()=>{const l=M.currentUser;if(!l)return null;const t=m(c,"users"),s=nt(t,lt("uid","==",l.uid)),n=await D(s);if(!n.empty){const a=n.docs[0];return y.value=a.data(),a.id}return null},V=async()=>{const l=await A();if(!l)return;const t=m(c,"users",l,"expenses"),s=await D(t);b.value=s.docs.map(n=>({id:n.id,...n.data()})),j(),F()},S=Q(()=>Object.values(B.value).reduce((l,t)=>l+t,0)),j=()=>{const l=new Set;b.value.forEach(t=>{if(t.date){const s=new Date(t.date),n=`${String(s.getMonth()+1).padStart(2,"0")}/${s.getFullYear()}`;l.add(n)}}),h.value=Array.from(l).sort((t,s)=>new Date(`01/${s}`)-new Date(`01/${t}`)),h.value.length>0&&(v.value=h.value[0])},f=o(0),O=async()=>{const l=await A();if(!l)return;const t=m(c,"users",l,"spendingGoals"),s=await D(t);let n=0;s.forEach(a=>{const p=a.data();p.goal&&(n+=p.goal)}),f.value=n,q()},F=()=>{if(!v.value)return;const l=b.value.filter(n=>{const a=new Date(n.date);return`${String(a.getMonth()+1).padStart(2,"0")}/${a.getFullYear()}`===v.value}),t={};l.forEach(n=>{t[n.category]||(t[n.category]=0),t[n.category]+=n.cost}),x.value=Object.entries(t),B.value=t;const s={};l.forEach(n=>{const a=new Date(n.date).getDate();s[a]=(s[a]||0)+n.cost}),I.value=Object.entries(s).map(([n,a])=>[`${v.value.split("/")[1]}-${v.value.split("/")[0]}-${n}`,a]).sort((n,a)=>new Date(n[0])-new Date(a[0])),q()},q=()=>{if(f.value===0)return;const l=S.value,t=Math.max(f.value-l,0),s=l<=f.value;st($(c,"users",y.value.uid),{isMeetingTarget:s}),k.value=[["Spent",l,"#f44336"],["Remaining Budget",t,"#4caf50"]]},z=async()=>{if(y.value.role==="FA"){const l=M.currentUser,t=m(c,"users",l.uid,"clients");return(await D(t)).size}return 0},d=o(null),C=o([]),G=async()=>{const l=M.currentUser;if(!l){console.error("No authenticated user found.");return}try{const t=m(c,"users",l.uid,"clients"),s=await D(t);C.value=s.docs.map(n=>({id:n.id,...n.data()}))}catch(t){console.error("Error fetching clients:",t)}Y()},H=async l=>{try{const t=$(c,"users",l.id),s=await U(t);s.exists()?d.value={id:l.id,...s.data()}:console.error("Client document does not exist.")}catch(t){console.error("Error fetching client document:",t)}},R=()=>{d.value=null},Y=async()=>{let l=0;const t=C.value.length;for(const n of C.value)try{const a=$(c,"users",n.id),p=await U(a);p.exists()?p.data().isMeetingTarget&&l++:console.warn(`Client document does not exist for ID: ${n.id}`)}catch(a){console.error(`Error polling client document for ID: ${n.id}`,a)}const s=t-l;T.value=[["Meeting",l,"#f44336"],["Not Meeting",s,"#4caf50"]]};return W(async()=>{await V(),await O(),E.value=await z(),await G()}),(l,t)=>{const s=_("pie-chart");return i(),u("div",null,[w(at),e("div",ot,[y.value.role==="FA"?(i(),u("div",rt,t[1]||(t[1]=[e("h2",null,"Client Analytics",-1)]))):(i(),u("div",ut,t[2]||(t[2]=[e("h2",null,"Expense Analytics",-1)]))),y.value.role==="FA"?(i(),u("div",it,[e("p",null,"Total Clients: "+r(E.value),1),t[11]||(t[11]=e("h2",null,"My Clients",-1)),e("ul",null,[(i(!0),u(N,null,P(C.value,n=>(i(),u("li",{key:n.id},[g(r(n.username)+" ",1),e("button",{onClick:a=>H(n)},"View",8,dt)]))),128))]),e("div",ct,[d.value?(i(),u("div",{key:0,class:"modal-overlay",onClick:Z(R,["self"])},[e("div",gt,[t[9]||(t[9]=e("h3",null,"Client Details",-1)),e("p",null,[t[3]||(t[3]=e("strong",null,"Username:",-1)),g(" "+r(d.value.username),1)]),e("p",null,[t[4]||(t[4]=e("strong",null,"Email:",-1)),g(" "+r(d.value.email),1)]),e("p",null,[t[5]||(t[5]=e("strong",null,"Savings Target:",-1)),g(" "+r(d.value.savingTarget),1)]),e("p",null,[t[6]||(t[6]=e("strong",null,"Gender:",-1)),g(" "+r(d.value.gender),1)]),e("p",null,[t[7]||(t[7]=e("strong",null,"Age:",-1)),g(" "+r(d.value.age),1)]),e("p",null,[t[8]||(t[8]=e("strong",null,"Meeting Target:",-1)),g(" "+r(d.value.isMeetingTarget),1)]),e("button",{onClick:R},"Close")])])):X("",!0)]),e("div",vt,[e("div",ft,[t[10]||(t[10]=e("h3",null,"Clients Meeting Target",-1)),w(s,{data:T.value,download:!0,colors:["#008000","#ff0000"]},null,8,["data"])])])])):(i(),u("div",pt,[t[17]||(t[17]=e("label",null,"Select Month:",-1)),tt(e("select",{"onUpdate:modelValue":t[0]||(t[0]=n=>v.value=n),onChange:F},[(i(!0),u(N,null,P(h.value,n=>(i(),u("option",{key:n,value:n},r(n),9,yt))),128))],544),[[et,v.value]]),e("h1",null," Total budget: "+r(f.value),1),t[18]||(t[18]=g()),t[19]||(t[19]=e("br",null,null,-1)),e("div",mt,[e("div",Dt,[t[12]||(t[12]=e("h3",null,"Budget Usage",-1)),w(s,{data:k.value,download:!0,colors:["#ff0000","#008000"]},null,8,["data"])]),e("div",ht,[t[13]||(t[13]=e("h3",null,"Spending by Category",-1)),w(s,{data:x.value,download:!0},null,8,["data"])])]),t[20]||(t[20]=e("h3",null,"Budget Summary",-1)),e("table",null,[e("tbody",null,[e("tr",null,[t[14]||(t[14]=e("th",null,"Total Budget ($):",-1)),e("td",null,"$"+r(f.value.toFixed(2)),1)]),e("tr",null,[t[15]||(t[15]=e("th",null,"Spent Amount ($):",-1)),e("td",null,"$"+r(S.value.toFixed(2)),1)]),e("tr",null,[t[16]||(t[16]=e("th",null,"Remaining Balance ($):",-1)),e("td",null,"$"+r((f.value-S.value).toFixed(2)),1)])])]),t[21]||(t[21]=e("br",null,null,-1)),t[22]||(t[22]=e("h3",null,"Breakdown by Category",-1)),t[23]||(t[23]=e("table",null,[e("thead",null,[e("tr",null,[e("th",null,"Category"),e("th",null,"Amount ($)")])])],-1))]))])])}}},$t=L(Ct,[["__scopeId","data-v-3fe11872"]]);export{$t as default};
