import{_,m as ee,g as te,r as c,n as U,p as ae,c as r,x as le,a,b as V,w as u,B as m,F as I,y as N,E as O,t as p,v as E,j as R,l as $,f as S,D as oe,G as P,H as ne,q as Y,k as B,I as L,o as i,J as G}from"./index-DoOH1WHm.js";import{_ as se}from"./finbonacci_logo-Sqr38KoG.js";import{N as re}from"./TheNavbar-zCnu1AXD.js";const ue={class:"container"},ie={class:"filter-buttons-container"},de=["value"],ce=["value"],pe={class:"expenses-table"},ve=["onClick"],ye=["onClick"],ge={key:0,class:"modal"},fe={class:"modal-content smaller-modal"},me={class:"modal-title"},De={key:0},be={class:"modal-button-group"},Ee={key:1,class:"modal-overlay"},xe={class:"modal smaller-modal"},we={class:"button-group"},he={key:0},Ce={key:1},Fe={__name:"ExpensePage",setup(ke){const v=ee(),j=te(),x=c([]),q=c("dateDesc"),y=c(!1),D=c(!1),g=c(!1),w=c(null),M=c({id:null,isRecurring:!1}),h=c(""),C=c(""),o=c({title:"",cost:0,date:"",category:"Food",type:"One Time",recurrenceFrequency:"",recurrenceEndDate:""}),z=()=>{o.value={title:"",cost:"",date:"",category:"Food",type:"One Time",recurrenceFrequency:"",recurrenceEndDate:""},g.value=!1,y.value=!0},H=(l,e)=>{M.value={id:l,isRecurring:e},D.value=!0},T=async l=>{const{id:e,isRecurring:t}=M.value,n=await F();if(n){if(t){if(l==="all")try{const s=R(v,"users",n,"expenses"),d=Y(s,B("title","==",x.value.find(b=>b.id===e).title)),f=await $(d),A=P(v);f.forEach(b=>{A.delete(b.ref)}),await A.commit(),alert("All occurrences of the recurring expense have been deleted.")}catch(s){console.error("Error deleting all occurrences of recurring expense:",s),alert("Failed to delete all occurrences. Please try again.")}else if(l==="this")try{const s=S(v,"users",n,"expenses",e);await L(s),alert("The specific occurrence has been deleted.")}catch(s){console.error("Error deleting specific occurrence of recurring expense:",s),alert("Failed to delete the specific occurrence. Please try again.")}}else try{const s=S(v,"users",n,"expenses",e);await L(s),alert("The one-time expense has been deleted.")}catch(s){console.error("Error deleting one-time expense:",s),alert("Failed to delete the expense. Please try again.")}D.value=!1,k()}},F=async()=>{const l=j.currentUser;if(!l)return null;const e=R(v,"users"),t=Y(e,B("uid","==",l.uid)),n=await $(t);return n.empty?null:n.docs[0].id},k=async()=>{const l=await F();if(!l)return;const e=R(v,"users",l,"expenses"),t=await $(e);x.value=t.docs.map(n=>({id:n.id,...n.data()}))},J=async()=>{const l=await F();if(!l){alert("Failed to retrieve user document ID.");return}const e=R(v,"users",l,"expenses");if(o.value.type==="Recurring"&&o.value.recurrenceFrequency&&o.value.recurrenceEndDate){const t=new Date(o.value.date),n=new Date(o.value.recurrenceEndDate);if(isNaN(t)||isNaN(n)){alert("Invalid start or end date. Please check your input.");return}const s=[];let d=new Date(t);for(;d<=n;)s.push({...o.value,date:d.toISOString().split("T")[0],isRecurring:!0}),o.value.recurrenceFrequency==="weekly"?d.setDate(d.getDate()+7):o.value.recurrenceFrequency==="monthly"?d.setMonth(d.getMonth()+1):o.value.recurrenceFrequency==="yearly"&&d.setFullYear(d.getFullYear()+1);try{const f=P(v);s.forEach(A=>{const b=S(e);f.set(b,A)}),await f.commit(),alert("Recurring expenses added successfully!")}catch(f){console.error("Error adding recurring expenses:",f),alert("Failed to add recurring expenses. Please try again.")}}else try{await ne(e,o.value),alert("Expense added successfully!")}catch(t){console.error("Error adding expense:",t),alert("Failed to add expense. Please try again.")}y.value=!1,k()},W=l=>{o.value={...l},g.value=!0,w.value=l.id,y.value=!0},K=async()=>{const l=await F();if(!l||!w.value)return;const e=S(v,"users",l,"expenses",w.value);await oe(e,o.value),y.value=!1,g.value=!1,w.value=null,k()},Q=U(()=>x.value.filter(l=>{const e=new Date(l.date),t=!h.value||(e.getMonth()+1).toString().padStart(2,"0")===h.value,n=!C.value||e.getFullYear().toString()===C.value;return t&&n})),X=U(()=>{let l=[...Q.value];switch(q.value){case"costAsc":return l.sort((e,t)=>e.cost-t.cost);case"costDesc":return l.sort((e,t)=>t.cost-e.cost);case"dateAsc":return l.sort((e,t)=>new Date(e.date)-new Date(t.date));case"dateDesc":return l.sort((e,t)=>new Date(t.date)-new Date(e.date));case"alphaAsc":return l.sort((e,t)=>e.title.localeCompare(t.title));case"alphaDesc":return l.sort((e,t)=>t.title.localeCompare(e.title));case"category":return l.sort((e,t)=>e.category.localeCompare(t.category));case"type":return l.sort((e,t)=>e.type.localeCompare(t.type));default:return l}}),Z=U(()=>Array.from(new Set(x.value.map(l=>new Date(l.date).getFullYear().toString()))).sort((l,e)=>e-l));return ae(k),(l,e)=>(i(),r("div",null,[le(re),a("div",ue,[e[22]||(e[22]=a("div",{class:"header"},[a("h2",null,"All Expenses"),a("img",{src:se,alt:"Logo",class:"logo-image"})],-1)),a("div",ie,[u(a("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>h.value=t),class:"filter-button"},[e[18]||(e[18]=a("option",{value:""},"All Months",-1)),(i(),r(I,null,N(12,t=>a("option",{key:t,value:t.toString().padStart(2,"0")},p(new Date(0,t-1).toLocaleString("default",{month:"long"})),9,de)),64))],512),[[m,h.value]]),u(a("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>C.value=t),class:"filter-button"},[e[19]||(e[19]=a("option",{value:""},"All Years",-1)),(i(!0),r(I,null,N(Z.value,t=>(i(),r("option",{key:t,value:t},p(t),9,ce))),128))],512),[[m,C.value]]),u(a("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>q.value=t),class:"filter-button"},e[20]||(e[20]=[O('<option value="costAsc" data-v-023d62c0>Cost Asc</option><option value="costDesc" data-v-023d62c0>Cost Desc</option><option value="dateAsc" data-v-023d62c0>Date Asc</option><option value="dateDesc" data-v-023d62c0>Date Desc</option><option value="alphaAsc" data-v-023d62c0>Alphabetical Asc</option><option value="alphaDesc" data-v-023d62c0>Alphabetical Desc</option><option value="category" data-v-023d62c0>Category</option><option value="type" data-v-023d62c0>Type</option>',8)]),512),[[m,q.value]])]),a("table",pe,[e[21]||(e[21]=a("thead",null,[a("tr",null,[a("th",null,"Title"),a("th",null,"Merchant"),a("th",null,"Cost"),a("th",null,"Date"),a("th",null,"Category"),a("th",null,"Type"),a("th",{class:"actions-column"},"Actions")])],-1)),a("tbody",null,[(i(!0),r(I,null,N(X.value,t=>(i(),r("tr",{key:t.id,class:G({recurring:t.type==="Recurring","one-time":t.type==="One Time"})},[a("td",null,p(t.title),1),a("td",null,p(t.merchant),1),a("td",null,"$"+p(t.cost.toFixed(2)),1),a("td",null,p(t.date),1),a("td",null,[a("span",{class:G(["category-badge",t.category.toLowerCase().replace(/\s+/g,"-")])},p(t.category),3)]),a("td",null,p(t.type),1),a("td",null,[a("button",{class:"view-edit-button",onClick:n=>W(t)},"View & Edit",8,ve),a("button",{class:"delete-button",onClick:n=>H(t.id,t.isRecurring)}," Remove ",8,ye)])],2))),128))])]),a("div",{class:"add-expense-container"},[a("button",{class:"add-expense-btn",onClick:z},"Add Expense")])]),y.value?(i(),r("div",ge,[a("div",fe,[a("h3",me,p(g.value?"Edit Expense":"New Expense"),1),e[28]||(e[28]=a("label",{for:"title"},"Title",-1)),u(a("input",{id:"title","onUpdate:modelValue":e[3]||(e[3]=t=>o.value.title=t),placeholder:"Title"},null,512),[[E,o.value.title]]),e[29]||(e[29]=a("label",{for:"merchant"},"Merchant",-1)),u(a("input",{id:"merchant","onUpdate:modelValue":e[4]||(e[4]=t=>o.value.merchant=t),placeholder:"Merchant"},null,512),[[E,o.value.merchant]]),e[30]||(e[30]=a("label",{for:"cost"},"Cost",-1)),u(a("input",{id:"cost","onUpdate:modelValue":e[5]||(e[5]=t=>o.value.cost=t),type:"number",placeholder:"Cost"},null,512),[[E,o.value.cost,void 0,{number:!0}]]),e[31]||(e[31]=a("label",{for:"date"},"Date",-1)),u(a("input",{id:"date","onUpdate:modelValue":e[6]||(e[6]=t=>o.value.date=t),type:"date"},null,512),[[E,o.value.date]]),e[32]||(e[32]=a("label",{for:"category"},"Category",-1)),u(a("select",{id:"category","onUpdate:modelValue":e[7]||(e[7]=t=>o.value.category=t)},e[23]||(e[23]=[O('<option value="Food" data-v-023d62c0>Food</option><option value="Transport" data-v-023d62c0>Transport</option><option value="Shopping" data-v-023d62c0>Shopping</option><option value="Utilities" data-v-023d62c0>Utilities</option><option value="Groceries" data-v-023d62c0>Groceries</option><option value="Others" data-v-023d62c0>Others</option>',6)]),512),[[m,o.value.category]]),e[33]||(e[33]=a("label",{for:"type"},"Type",-1)),u(a("select",{id:"type","onUpdate:modelValue":e[8]||(e[8]=t=>o.value.type=t)},e[24]||(e[24]=[a("option",{value:"One Time"},"One Time",-1),a("option",{value:"Recurring"},"Recurring",-1)]),512),[[m,o.value.type]]),o.value.type==="Recurring"?(i(),r("div",De,[e[26]||(e[26]=a("label",{for:"recurrenceFrequency"},"Recurrence Frequency",-1)),u(a("select",{id:"recurrenceFrequency","onUpdate:modelValue":e[9]||(e[9]=t=>o.value.recurrenceFrequency=t)},e[25]||(e[25]=[a("option",{value:"weekly"},"Weekly",-1),a("option",{value:"monthly"},"Monthly",-1),a("option",{value:"yearly"},"Yearly",-1)]),512),[[m,o.value.recurrenceFrequency]]),e[27]||(e[27]=a("label",{for:"recurrenceEndDate"},"Recurrence End Date",-1)),u(a("input",{id:"recurrenceEndDate","onUpdate:modelValue":e[10]||(e[10]=t=>o.value.recurrenceEndDate=t),type:"date",placeholder:"Recurrence End Date"},null,512),[[E,o.value.recurrenceEndDate]])])):V("",!0),a("div",be,[a("button",{onClick:e[11]||(e[11]=t=>g.value?K():J())},p(g.value?"Update Expense":"Save Expense"),1),a("button",{onClick:e[12]||(e[12]=t=>y.value=!1),class:"cancel-button"},"Cancel")])])])):V("",!0),D.value?(i(),r("div",Ee,[a("div",xe,[e[34]||(e[34]=a("h3",{class:"modal-title"},"Are you sure you want to delete?",-1)),a("div",we,[M.value.isRecurring?(i(),r("div",he,[a("button",{onClick:e[13]||(e[13]=t=>T("all"))},"Delete All"),a("button",{onClick:e[14]||(e[14]=t=>T("this"))},"Delete This Only"),a("button",{onClick:e[15]||(e[15]=t=>D.value=!1),class:"cancel-button"},"Cancel")])):(i(),r("div",Ce,[a("button",{onClick:e[16]||(e[16]=t=>T("this"))},"Delete"),a("button",{onClick:e[17]||(e[17]=t=>D.value=!1),class:"cancel-button"},"Cancel")]))])])])):V("",!0)]))}},qe=_(Fe,[["__scopeId","data-v-023d62c0"]]);export{qe as default};
