import{_ as I,m as M,g as U,r as i,p as B,c as m,x as L,a as s,b as T,w as z,v as Q,F as h,y as x,d as W,z as u,t as c,f as d,C as Y,j as F,l as b,q as G,k as H,o as f,i as q,I as y}from"./index-DUYM3bTQ.js";import{N as J}from"./TheNavbar-DHRFYb2-.js";const K={class:"find-fa-container"},O={class:"columns"},P={class:"left-box"},X=["onClick"],Z={class:"right-box"},ee={class:"button-group"},te=["onClick"],se=["onClick"],ne=["onClick"],ae={class:"modal"},le={__name:"FindFA",setup(re){const l=M(),D=U(),p=i(""),C=i([]),r=i(null),v=i([]),o=i(""),g=i(""),w=i(""),R=i(null),E=async()=>{if(p.value.trim()===""){C.value=[];return}try{const t=F(l,"users"),e=G(t,H("role","==","FA")),n=await b(e);C.value=n.docs.map(a=>({id:a.id,...a.data()})).filter(a=>a.username.toLowerCase().startsWith(p.value.toLowerCase()))}catch(t){console.error("Error fetching FAs:",t)}},k=async()=>{const t=D.currentUser;if(t){o.value=t.uid;try{const e=d(l,"users",t.uid),n=await Y(e);if(n.exists()){const a=n.data();g.value=a.username||"",w.value=a.email||"",R.value=a.fa||null}}catch(e){console.error("Error fetching client:",e)}}},N=async()=>{if(o.value)try{const t=F(l,"users",o.value,"receivedRequests"),e=await b(t);v.value=e.docs.map(n=>({id:n.id,...n.data()}))}catch(t){console.error("Error fetching received requests:",t)}},V=async t=>{try{if((!g.value||!w.value)&&await k(),R.value){alert(`You already have an assigned FA: ${R.value.username}.`);return}const e=d(l,"users",o.value);await q(e,{fa:{id:t.id,username:t.username,email:t.email}},{merge:!0});const n=d(l,"users",t.id,"clients",o.value);await q(n,{id:o.value,username:g.value,email:w.value});const a=d(l,"users",o.value,"receivedRequests",t.id);await y(a);const S=d(l,"users",t.id,"sentRequests",o.value);await y(S),alert(`Accepted request from ${t.username}`),v.value=v.value.filter(j=>j.id!==t.id),R.value={id:t.id,username:t.username,email:t.email}}catch(e){console.error("Error accepting request:",e)}},$=async t=>{try{const e=d(l,"users",o.value,"receivedRequests",t.id);await y(e);const n=d(l,"users",t.id,"sentRequests",o.value);await y(n),alert(`Rejected request from ${t.username}`),v.value=v.value.filter(a=>a.id!==t.id)}catch(e){console.error("Error rejecting request:",e)}},A=async t=>{try{const e=F(l,"users",t.id,"clients"),n=await b(e);r.value={...t,totalClients:n.size}}catch{r.value={...t,totalClients:0}}},_=()=>{r.value=null};return B(async()=>{await k(),await N()}),(t,e)=>(f(),m(h,null,[L(J),s("div",K,[s("div",O,[s("div",P,[e[1]||(e[1]=s("h3",null,"Search for Financial Advisors",-1)),z(s("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=n=>p.value=n),placeholder:"Search for Financial Advisors...",onInput:E},null,544),[[Q,p.value]]),e[2]||(e[2]=s("h3",null,"Results:",-1)),s("ul",null,[(f(!0),m(h,null,x(C.value,n=>(f(),m("li",{key:n.id},[u(c(n.username)+" ",1),s("button",{onClick:a=>A(n)},"View",8,X)]))),128))])]),s("div",Z,[e[3]||(e[3]=s("h3",null,"Received Requests",-1)),s("ul",null,[(f(!0),m(h,null,x(v.value,n=>(f(),m("li",{key:n.id},[u(c(n.username)+" ",1),s("div",ee,[s("button",{onClick:a=>A(n)},"View",8,te),s("button",{onClick:a=>V(n)},"Accept",8,se),s("button",{onClick:a=>$(n)},"Remove",8,ne)])]))),128))])])]),r.value?(f(),m("div",{key:0,class:"modal-overlay",onClick:W(_,["self"])},[s("div",ae,[e[10]||(e[10]=s("h3",null,"FA Details",-1)),s("p",null,[e[4]||(e[4]=s("strong",null,"Username:",-1)),u(" "+c(r.value.username),1)]),s("p",null,[e[5]||(e[5]=s("strong",null,"Email:",-1)),u(" "+c(r.value.email),1)]),s("p",null,[e[6]||(e[6]=s("strong",null,"Company:",-1)),u(" "+c(r.value.company),1)]),s("p",null,[e[7]||(e[7]=s("strong",null,"About:",-1)),u(" "+c(r.value.about),1)]),s("p",null,[e[8]||(e[8]=s("strong",null,"Representative Number:",-1)),u(" "+c(r.value.regNumber),1)]),s("p",null,[e[9]||(e[9]=s("strong",null,"Total Clients:",-1)),u(" "+c(r.value.totalClients),1)]),s("div",{class:"button-container"},[s("button",{onClick:_},"Close")])])])):T("",!0)])],64))}},ue=I(le,[["__scopeId","data-v-5c061e2f"]]);export{ue as default};
