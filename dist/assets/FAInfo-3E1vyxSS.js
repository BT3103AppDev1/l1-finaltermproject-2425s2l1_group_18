import{_ as q,m as z,g as P,r as m,n as $,p as D,c as i,x as Y,a as t,b as R,z as v,t as a,w as _,B as G,F as k,y as H,d as J,f,D as x,j as M,l as N,C as K,I as Q,u as W,o as u}from"./index-DXTcdSJ3.js";import{N as X}from"./TheNavbar-CtdwB5Id.js";const Z={class:"fa-info-container"},ee={key:0,class:"fa-details-box"},te={key:1,class:"no-fa-box"},oe={key:0,class:"memos-container"},ne=["value"],se={class:"modal"},ae={__name:"FAInfo",setup(le){const c=z(),F=P(),U=W(),s=m(null),p=m(""),g=m([]),l=m(null),b=m(!1),w=async()=>{var e;const n=F.currentUser;if(n){p.value=n.uid;try{const o=f(c,"users",n.uid),d=await x(o);if(d.exists()){const r=d.data(),y=(e=r==null?void 0:r.fa)==null?void 0:e.id;if(y){const B=f(c,"users",y),A=await x(B);if(A.exists()){const T=A.data(),j=M(c,"users",y,"clients"),O=(await N(j)).size;s.value={...T,totalClients:O,adviceAvailable:r.adviceAvailable||!1,adviceDate:r.adviceDate||"",adviceFileURL:r.adviceFileURL||null,adviceText:r.adviceText||""}}}}}catch(o){console.error("Error fetching FA:",o)}}},L=async()=>{try{const n=F.currentUser;if(!n)return;const e=M(c,"users",n.uid,"advice"),o=await N(e);g.value=o.docs.map(d=>({id:d.id,...d.data(),date:d.data().timestamp.toDate().toLocaleDateString()}))}catch(n){console.error("Error fetching memos:",n)}},h=()=>{l.value&&(b.value=!0)},E=$(()=>[...g.value].sort((n,e)=>new Date(e.timestamp)-new Date(n.timestamp))),I=()=>{if(!l.value)return;const n=new Blob([l.value.content],{type:"text/plain"}),e=URL.createObjectURL(n),o=document.createElement("a");o.href=e,o.download=`${l.value.label}.txt`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(e)},C=()=>{b.value=!1};D(()=>{w(),L()});const S=async()=>{if(s.value)try{const n=f(c,"users",p.value);await K(n,{fa:null});const e=f(c,"users",s.value.uid,"clients",p.value);await Q(e),alert(`Removed Financial Advisor: ${s.value.username}`),s.value=null}catch(n){console.error("Error removing FA:",n)}},V=()=>{U.push("/find-fa")};return D(w),(n,e)=>(u(),i(k,null,[Y(X),t("div",Z,[e[9]||(e[9]=t("h2",null,"My Financial Advisor",-1)),s.value?(u(),i("div",ee,[t("p",null,[e[1]||(e[1]=t("strong",null,"Username:",-1)),v(" "+a(s.value.username),1)]),t("p",null,[e[2]||(e[2]=t("strong",null,"Email:",-1)),v(" "+a(s.value.email),1)]),t("p",null,[e[3]||(e[3]=t("strong",null,"Company:",-1)),v(" "+a(s.value.company),1)]),t("p",null,[e[4]||(e[4]=t("strong",null,"About:",-1)),v(" "+a(s.value.about),1)]),t("p",null,[e[5]||(e[5]=t("strong",null,"Representative Number:",-1)),v(" "+a(s.value.representativeNumber),1)]),t("p",null,[e[6]||(e[6]=t("strong",null,"Total Clients:",-1)),v(" "+a(s.value.totalClients),1)]),t("button",{onClick:S,class:"remove-btn"},"Remove FA")])):(u(),i("div",te,[e[7]||(e[7]=t("h3",null,"Oops! No Financial Advisor Now.",-1)),e[8]||(e[8]=t("p",null,"Add one to get started!",-1)),t("button",{onClick:V,class:"find-fa-btn"},"Find Financial Advisor")]))]),s.value?(u(),i("div",oe,[e[11]||(e[11]=t("h3",null,"View Memos from Your Financial Advisor",-1)),_(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>l.value=o),class:"memo-dropdown",onChange:h},[e[10]||(e[10]=t("option",{disabled:"",value:""},"Select a memo",-1)),(u(!0),i(k,null,H(E.value,o=>(u(),i("option",{key:o.id,value:o},a(o.label)+" ("+a(o.date)+") ",9,ne))),128))],544),[[G,l.value]]),b.value?(u(),i("div",{key:0,class:"modal-overlay",onClick:J(C,["self"])},[t("div",se,[t("h3",null,a(l.value.label),1),t("p",null,a(l.value.content),1),t("button",{onClick:I},"Download"),t("button",{onClick:C},"Close")])])):R("",!0)])):R("",!0)],64))}},ce=q(ae,[["__scopeId","data-v-5654ee50"]]);export{ce as default};
