import{_ as tt,m as et,g as nt,r as i,n as z,p as lt,c as o,x as h,a as e,t as r,F as T,y as x,b as G,d as st,z as f,A as H,w as at,B as ot,j as D,l as w,f as S,C as A,q as rt,k as ut,D as it,o as u}from"./index-BLU3K2nf.js";import{N as dt}from"./TheNavbar-psDHII7v.js";const ct={class:"container"},gt={key:0},vt={key:1},ft={key:2},pt=["onClick"],yt={class:"find-client-container"},mt={class:"modal"},ht={class:"charts-container"},Dt={class:"chart"},wt={class:"not-meeting-table"},Ct={key:0},Mt={key:1},bt={key:3},Tt=["value"],xt={key:0,style:{color:"red","font-weight":"bold","margin-top":"10px"}},St={class:"chart"},kt={class:"chart"},$t={class:"chart"},Et={__name:"HomePage",setup(Bt){const c=et(),k=nt(),$=i([]),p=i(""),C=i([]),F=i([]),N=i([]),q=i([]),R=i([]),E=i({}),y=i({}),U=i(0),I=async()=>{const l=k.currentUser;if(!l)return null;const t=D(c,"users"),a=rt(t,ut("uid","==",l.uid)),s=await w(a);if(!s.empty){const n=s.docs[0];return y.value=n.data(),n.id}return null},L=async()=>{const l=await I();if(!l)return;const t=D(c,"users",l,"expenses"),a=await w(t);$.value=a.docs.map(s=>({id:s.id,...s.data()})),_(),P()},M=z(()=>Object.values(E.value).reduce((l,t)=>l+t,0)),_=()=>{const l=new Set;$.value.forEach(t=>{if(t.date){const a=new Date(t.date),s=`${String(a.getMonth()+1).padStart(2,"0")}/${a.getFullYear()}`;l.add(s)}}),C.value=Array.from(l).sort((t,a)=>new Date(`01/${a}`)-new Date(`01/${t}`)),C.value.length>0&&(p.value=C.value[0])},v=i(0),J=async()=>{const l=await I();if(!l)return;const t=D(c,"users",l,"spendingGoals"),a=await w(t);let s=0;a.forEach(n=>{const d=n.data();d.goal&&(s+=d.goal)}),v.value=s,V()},P=()=>{if(!p.value)return;const l=$.value.filter(s=>{const n=new Date(s.date);return`${String(n.getMonth()+1).padStart(2,"0")}/${n.getFullYear()}`===p.value}),t={};l.forEach(s=>{t[s.category]||(t[s.category]=0),t[s.category]+=s.cost}),N.value=Object.entries(t),E.value=t;const a={};l.forEach(s=>{const n=new Date(s.date).getDate();a[n]=(a[n]||0)+s.cost}),q.value=Object.entries(a).map(([s,n])=>[`${p.value.split("/")[1]}-${p.value.split("/")[0]}-${s}`,n]).sort((s,n)=>new Date(s[0])-new Date(n[0])),V()},V=()=>{if(v.value===0)return;const l=M.value,t=Math.max(v.value-l,0),a=l<=v.value;it(S(c,"users",y.value.uid),{isMeetingTarget:a}),R.value=[["Spent",l,"#f44336"],["Remaining Budget",t,"#4caf50"]]},K=async()=>{if(y.value.role==="FA"){const l=k.currentUser,t=D(c,"users",l.uid,"clients");return(await w(t)).size}return 0},g=i(null),m=i([]),j=z(()=>m.value.filter(l=>!l.isMeetingTarget)),Q=async()=>{const l=k.currentUser;if(!l){console.error("No authenticated user found.");return}try{const t=D(c,"users",l.uid,"clients"),a=await w(t),s=[];for(const n of a.docs){const d=n.data(),B=n.id,Z=S(c,"users",B),Y=await A(Z);if(Y.exists()){const b=Y.data();s.push({id:B,username:b.username,email:b.email,isMeetingTarget:b.isMeetingTarget,...b})}}m.value=s}catch(t){console.error("Error fetching clients:",t)}X()},W=async l=>{try{const t=S(c,"users",l.id),a=await A(t);a.exists()?g.value={id:l.id,...a.data()}:console.error("Client document does not exist.")}catch(t){console.error("Error fetching client document:",t)}},O=()=>{g.value=null},X=async()=>{let l=0;const t=m.value.length;for(const s of m.value)try{const n=S(c,"users",s.id),d=await A(n);d.exists()?d.data().isMeetingTarget&&l++:console.warn(`Client document does not exist for ID: ${s.id}`)}catch(n){console.error(`Error polling client document for ID: ${s.id}`,n)}const a=t-l;F.value=[["Meeting",l,"#f44336"],["Not Meeting",a,"#4caf50"]]};return lt(async()=>{await L(),await J(),U.value=await K(),await Q()}),(l,t)=>{const a=H("pie-chart"),s=H("line-chart");return u(),o("div",null,[h(dt),e("div",ct,[y.value.role==="FA"?(u(),o("div",gt,t[1]||(t[1]=[e("h2",null,"Client Analytics",-1)]))):(u(),o("div",vt,t[2]||(t[2]=[e("h2",null,"Expense Analytics",-1)]))),y.value.role==="FA"?(u(),o("div",ft,[e("p",null,"Total Clients: "+r(U.value),1),t[13]||(t[13]=e("h2",null,"My Clients",-1)),e("ul",null,[(u(!0),o(T,null,x(m.value,n=>(u(),o("li",{key:n.id},[f(r(n.username)+" ",1),e("button",{onClick:d=>W(n)},"View",8,pt)]))),128))]),e("div",yt,[g.value?(u(),o("div",{key:0,class:"modal-overlay",onClick:st(O,["self"])},[e("div",mt,[t[9]||(t[9]=e("h3",null,"Client Details",-1)),e("p",null,[t[3]||(t[3]=e("strong",null,"Username:",-1)),f(" "+r(g.value.username),1)]),e("p",null,[t[4]||(t[4]=e("strong",null,"Email:",-1)),f(" "+r(g.value.email),1)]),e("p",null,[t[5]||(t[5]=e("strong",null,"Savings Target:",-1)),f(" "+r(g.value.savingTarget),1)]),e("p",null,[t[6]||(t[6]=e("strong",null,"Gender:",-1)),f(" "+r(g.value.gender),1)]),e("p",null,[t[7]||(t[7]=e("strong",null,"Age:",-1)),f(" "+r(g.value.age),1)]),e("p",null,[t[8]||(t[8]=e("strong",null,"Meeting Target:",-1)),f(" "+r(g.value.isMeetingTarget),1)]),e("button",{onClick:O},"Close")])])):G("",!0)]),e("div",ht,[e("div",Dt,[t[10]||(t[10]=e("h3",null,"Clients Meeting Target",-1)),h(a,{data:F.value,download:!0,colors:["#008000","#ff0000"]},null,8,["data"])]),e("div",wt,[t[12]||(t[12]=e("h3",null,"Clients Not Meeting Their Target",-1)),j.value.length?(u(),o("table",Ct,[t[11]||(t[11]=e("thead",null,[e("tr",null,[e("th",null,"Username"),e("th",null,"Email")])],-1)),e("tbody",null,[(u(!0),o(T,null,x(j.value,n=>(u(),o("tr",{key:n.id},[e("td",null,r(n.username),1),e("td",null,r(n.email),1)]))),128))])])):(u(),o("p",Mt,"No clients are currently below their targets 🎉"))])])])):(u(),o("div",bt,[t[21]||(t[21]=e("label",null,"Select Month:",-1)),at(e("select",{"onUpdate:modelValue":t[0]||(t[0]=n=>p.value=n),onChange:P},[(u(!0),o(T,null,x(C.value,n=>(u(),o("option",{key:n,value:n},r(n),9,Tt))),128))],544),[[ot,p.value]]),M.value>v.value?(u(),o("p",xt," ⚠️ You have exceeded your budget for this month! ")):G("",!0),e("h1",null," Total budget: "+r(v.value),1),t[22]||(t[22]=f()),t[23]||(t[23]=e("br",null,null,-1)),e("div",St,[t[14]||(t[14]=e("h3",null,"Budget Usage",-1)),h(a,{data:R.value,download:!0,colors:["#ff0000","#008000"]},null,8,["data"])]),t[24]||(t[24]=e("h3",null,"Budget Summary",-1)),e("table",null,[e("tbody",null,[e("tr",null,[t[15]||(t[15]=e("th",null,"Total Budget ($):",-1)),e("td",null,"$"+r(v.value.toFixed(2)),1)]),e("tr",null,[t[16]||(t[16]=e("th",null,"Spent Amount ($):",-1)),e("td",null,"$"+r(M.value.toFixed(2)),1)]),e("tr",null,[t[17]||(t[17]=e("th",null,"Remaining Balance ($):",-1)),e("td",null,"$"+r((v.value-M.value).toFixed(2)),1)])])]),t[25]||(t[25]=e("br",null,null,-1)),e("div",kt,[t[18]||(t[18]=e("h3",null,"Spending by Category",-1)),h(a,{data:N.value,download:!0},null,8,["data"])]),t[26]||(t[26]=e("h3",null,"Breakdown by Category",-1)),e("table",null,[t[19]||(t[19]=e("thead",null,[e("tr",null,[e("th",null,"Category"),e("th",null,"Amount ($)")])],-1)),e("tbody",null,[(u(!0),o(T,null,x(E.value,(n,d)=>(u(),o("tr",{key:d},[e("td",null,r(d),1),e("td",null,"$"+r(n.toFixed(2)),1)]))),128))])]),e("div",$t,[t[20]||(t[20]=e("h3",null,"Spending Over Days of the Month",-1)),h(s,{data:q.value,download:!0},null,8,["data"])])]))])])}}},Nt=tt(Et,[["__scopeId","data-v-09e61e3d"]]);export{Nt as default};
