import{_ as $,m as B,g as I,r as u,p as M,c as v,x as T,a as t,b as L,w as G,v as j,F as q,y as A,d as z,z as c,t as i,f,C as Q,j as w,l as y,q as W,k as H,o as m,G as J,I as x}from"./index-BLU3K2nf.js";import{N as K}from"./TheNavbar-psDHII7v.js";const O={class:"find-client-container"},P={class:"columns"},X={class:"box search-box"},Y={class:"button-group"},Z=["onClick"],ee=["disabled","onClick"],se={class:"box requests-box"},te={class:"button-group"},ne=["onClick"],oe=["onClick"],re={class:"modal"},ae={__name:"FindClient",setup(le){const r=B(),E=I(),g=u(""),p=u([]),l=u(null),d=u([]),C=u([]),a=u(""),h=u(""),R=u(""),S=async()=>{if(g.value.trim()===""){p.value=[];return}try{const s=w(r,"users"),e=W(s,H("role","==","User")),n=await y(e);p.value=n.docs.map(o=>({id:o.id,...o.data()})).filter(o=>o.username.toLowerCase().startsWith(g.value.toLowerCase()))}catch(s){console.error("Error fetching clients:",s)}},D=async()=>{try{const s=w(r,"users",a.value,"sentRequests"),e=await y(s);d.value=e.docs.map(n=>({id:n.id,...n.data()}))}catch(s){console.error("Error fetching sent requests:",s)}},N=async()=>{try{const s=w(r,"users",a.value,"clients"),e=await y(s);C.value=e.docs.map(n=>({id:n.id,...n.data()}))}catch(s){console.error("Error fetching clients:",s)}},b=async()=>{const s=E.currentUser;if(!s){console.error("No authenticated user found.");return}a.value=s.uid,console.log("Fetching FA details for user ID:",a.value);try{const e=f(r,"users",s.uid),n=await Q(e);if(n.exists()){const o=n.data();console.log("FA document data:",o),h.value=o.username||"Unknown Username",R.value=o.email||"Unknown Email"}else console.error("FA document does not exist in Firestore.")}catch(e){console.error("Error fetching FA details:",e)}},k=s=>d.value.some(e=>e.id===s)||C.value.some(e=>e.id===s),F=s=>{l.value=s},_=()=>{l.value=null},U=async s=>{try{if((!h.value||!R.value)&&await b(),!h.value||!R.value){console.error("FA details are still missing after fetching."),alert("Error: Unable to send request. FA details are missing.");return}const e=J(r),n=f(r,"users",a.value,"sentRequests",s.id),o=f(r,"users",s.id,"receivedRequests",a.value);e.set(n,{id:s.id,username:s.username,email:s.email}),e.set(o,{id:a.value,username:h.value,email:R.value}),await e.commit(),alert(`Request sent to ${s.username}`),d.value.push({id:s.id,username:s.username,email:s.email})}catch(e){console.error("Error sending request:",e)}},V=async s=>{try{const e=f(r,"users",a.value,"sentRequests",s.id);await x(e);const n=f(r,"users",s.id,"receivedRequests",a.value);await x(n),alert(`Request to ${s.username} deleted`),d.value=d.value.filter(o=>o.id!==s.id)}catch(e){console.error("Error deleting request:",e)}};return M(async()=>{await b(),await D(),await N()}),(s,e)=>(m(),v(q,null,[T(K),t("div",O,[t("div",P,[t("div",X,[e[1]||(e[1]=t("h3",null,"Search for Clients",-1)),G(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=n=>g.value=n),placeholder:"Search for Clients...",onInput:S},null,544),[[j,g.value]]),e[2]||(e[2]=t("h3",null,"Results:",-1)),t("ul",null,[(m(!0),v(q,null,A(p.value,n=>(m(),v("li",{key:n.id},[c(i(n.username)+" ",1),t("div",Y,[t("button",{onClick:o=>F(n)},"View",8,Z),t("button",{disabled:k(n.id),onClick:o=>U(n)},i(k(n.id)?"Request Not Allowed":"Send Request"),9,ee)])]))),128))])]),t("div",se,[e[3]||(e[3]=t("h3",null,"Sent Requests",-1)),t("ul",null,[(m(!0),v(q,null,A(d.value,n=>(m(),v("li",{key:n.id},[c(i(n.username)+" ",1),t("div",te,[t("button",{onClick:o=>F(n)},"View",8,ne),t("button",{onClick:o=>V(n)},"Remove",8,oe)])]))),128))])])]),l.value?(m(),v("div",{key:0,class:"modal-overlay",onClick:z(_,["self"])},[t("div",re,[e[9]||(e[9]=t("h3",null,"Client Details",-1)),t("p",null,[e[4]||(e[4]=t("strong",null,"Username:",-1)),c(" "+i(l.value.username),1)]),t("p",null,[e[5]||(e[5]=t("strong",null,"Email:",-1)),c(" "+i(l.value.email),1)]),t("p",null,[e[6]||(e[6]=t("strong",null,"Savings Target:",-1)),c(" "+i(l.value.savingTarget),1)]),t("p",null,[e[7]||(e[7]=t("strong",null,"Gender:",-1)),c(" "+i(l.value.gender),1)]),t("p",null,[e[8]||(e[8]=t("strong",null,"Age:",-1)),c(" "+i(l.value.age),1)]),t("button",{onClick:_},"Close")])])):L("",!0)])],64))}},ce=$(ae,[["__scopeId","data-v-c1219990"]]);export{ce as default};
